<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Minneapolis Skyway Navigator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Skyway Navigator">
    <meta name="description" content="Navigate the Minneapolis Skyway System with confidence - operating hours, routes, and tips">
    
    <!-- JavaScript Files - Load in correct order -->
    <script src="js/buildingData.js"></script>
    <script src="js/routePlanner.js"></script>
    <script src="js/buildingDirectory.js"></script>
    <script src="js/mapController.js"></script>
    
    <!-- PWA Icons -->
    
    <!-- Load building data before other scripts -->
    <script src="js/buildingData.js"></script>
    <script src="js/buildingDirectory.js"></script>
    <script src="js/routePlanner.js"></script>
    <script src="js/mapController.js"></script>
    
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0yIDEySDZMMTAgOEgxNEwxOCAxMkgyMk0yIDEyVjE2SDE0VjEyTTEwIDhWNEgyMlY4SDE0IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+Cjwvc3ZnPgo=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0yIDEySDZMMTAgOEgxNEwxOCAxMkgyMk0yIDEyVjE2SDE0VjEyTTEwIDhWNEgyMlY4SDE0IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+Cjwvc3ZnPgo=">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #16213e 75%, #1a1a2e 100%);
            color: #e8eaed;
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(199, 21, 133, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.3) 0px, transparent 2px),
                radial-gradient(circle at 90% 80%, rgba(255, 20, 147, 0.3) 0px, transparent 2px),
                radial-gradient(circle at 30% 60%, rgba(199, 21, 133, 0.2) 0px, transparent 1px),
                radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.2) 0px, transparent 1px);
            background-size: 200px 200px, 300px 300px, 150px 150px, 250px 250px;
            animation: sparkle 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        .app-container {
            position: relative;
            width: 100vw;
            min-height: 100vh;
            padding-bottom: 80px;
            z-index: 10;
        }

        .header {
            position: sticky;
            top: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            box-shadow: 0 2px 20px rgba(59, 130, 246, 0.3);
            z-index: 100;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .header h1 {
            font-size: 1.2em;
            color: #60a5fa;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
        }

        .slide {
            display: none;
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
            animation: slideIn 0.3s ease-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .card {
            background: rgba(30, 41, 59, 0.85);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        h1 {
            color: #60a5fa;
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(96, 165, 250, 0.6);
        }

        h2 {
            color: #34d399;
            font-size: 1.4em;
            margin-bottom: 16px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(52, 211, 153, 0.5);
        }

        h3 {
            color: #a78bfa;
            font-size: 1.1em;
            margin: 16px 0 12px 0;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(167, 139, 250, 0.4);
        }

        p, li {
            font-size: 1em;
            line-height: 1.5;
            margin-bottom: 12px;
            color: #f0e6ff;
        }

        ul {
            margin-left: 16px;
            margin-bottom: 16px;
        }

        li {
            margin-bottom: 8px;
        }

        .highlight {
            background: linear-gradient(120deg, rgba(59, 130, 246, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            margin: 16px 0;
        }

        .warning {
            background: linear-gradient(120deg, rgba(251, 191, 36, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #f59e0b;
            margin: 16px 0;
        }

        .success {
            background: linear-gradient(120deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #22c55e;
            margin: 16px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 10px rgba(26, 13, 46, 0.8);
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 4px;
            position: relative;
            z-index: 1;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            background: rgba(26, 13, 46, 0.9);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(255, 20, 147, 0.3);
            font-size: 0.9em;
        }

        th {
            background: linear-gradient(135deg, #374151, #1f2937);
            color: #e5e7eb;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85em;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
            vertical-align: top;
            background: rgba(30, 41, 59, 0.3);
        }

        tr:nth-child(even) td {
            background: rgba(51, 65, 85, 0.3);
        }

        .building-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin: 16px 0;
        }

        .building-item {
            background: rgba(51, 65, 85, 0.6);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            font-size: 0.9em;
            color: #f0e6ff;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.2);
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 20px rgba(59, 130, 246, 0.3);
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .nav-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            transform: none;
        }

        .slide-counter {
            background: rgba(59, 130, 246, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            color: #60a5fa;
            font-size: 0.9em;
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .quick-action {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4);
            transition: transform 0.2s ease;
        }

        .quick-action:active {
            transform: scale(0.95);
        }

        .quick-action:visited {
            color: white;
        }

        /* New styles for enhanced features */
        .search-container {
            position: relative;
            margin: 16px 0;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1em;
            background: white;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .building-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 16px 0;
        }

        .building-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .building-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .building-card.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .building-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .building-address {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .building-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .route-planner {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }

        .route-selector {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .route-building {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .route-building.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .route-arrow {
            font-size: 1.5em;
            color: #667eea;
        }

        .route-result {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .route-path {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .route-segment {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .route-arrow-small {
            color: #667eea;
            font-weight: bold;
        }

        .route-warnings {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .route-warnings ul {
            margin: 0;
            padding-left: 16px;
        }

        .favorites-container {
            margin: 16px 0;
        }

        .favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .favorite-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .favorite-btn.active {
            color: #ff6b6b;
        }

        .status-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        .status-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #ccc;
        }

        .status-card.good {
            border-left-color: #4caf50;
        }

        .status-card.warning {
            border-left-color: #ff9800;
        }

        .status-card.poor {
            border-left-color: #f44336;
        }

        .weather-status {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
        }

        .install-prompt {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            display: none;
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.4);
        }

        .install-btn {
            background: white;
            color: #1d4ed8;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
            text-shadow: 0 0 5px rgba(26, 13, 46, 0.8);
        }

        /* Mobile optimizations */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stat-box {
                padding: 12px;
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            .card {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            table {
                font-size: 0.8em;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }

        /* PWA specific styles */
        @media (display-mode: standalone) {
            .header {
                padding-top: max(15px, env(safe-area-inset-top));
            }
            
            .navigation {
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
        }
        
        /* Building Discovery Styles */
        .building-discovery {
            margin: 20px 0;
        }
        
        .discovery-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .discovery-status {
            text-align: center;
            padding: 20px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #22c55e);
            animation: progress 2s ease-in-out infinite;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        .building-results {
            margin-top: 20px;
        }
        
        .results-summary {
            margin-bottom: 20px;
        }
        
        .building-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .building-filters select,
        .search-input {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(30, 41, 59, 0.8);
            color: #e8eaed;
            font-size: 0.9em;
        }
        
        .building-list {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.3);
            padding: 16px;
        }
        
        .building-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 3px solid #3b82f6;
        }
        
        .building-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .building-header h4 {
            margin: 0;
            color: #3b82f6;
            font-size: 1.1em;
        }
        
        .building-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .status-open {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .status-closed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-event-dependent {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .building-details {
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .building-address,
        .building-type {
            margin: 4px 0;
            color: #cbd5e1;
        }
        
        .building-hours {
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }
        
        .hours-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
        }
        
        .building-amenities {
            margin-top: 8px;
        }
        
        .amenity-tag {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin: 2px 4px 2px 0;
        }
        
        .no-results {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>Minneapolis Skyway Navigator</h1>
        </div>

        <div class="install-prompt" id="installPrompt">
            <p><strong>üì± Install this app!</strong></p>
            <p>Add to your home screen for quick access</p>
            <button class="install-btn" id="installBtn">Install App</button>
        </div>

        <!-- Slide 1: Home -->
        <div class="slide active">
            <div class="card">
                <h1>Welcome to Your Skyway Guide</h1>
                
                <div class="weather-status" id="weatherStatus">
                    <p><strong>üå§Ô∏è Perfect Skyway Weather!</strong></p>
                    <p>Great day to stay indoors and use the skyway system</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-number">80+</span>
                        <span class="stat-label">Segments</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">150+</span>
                        <span class="stat-label">Buildings</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">9.5</span>
                        <span class="stat-label">Miles</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">#1</span>
                        <span class="stat-label">Worldwide</span>
                    </div>
                </div>
                
                <div class="warning">
                    <p><strong>‚ö†Ô∏è Key Challenge</strong></p>
                    <p>No single schedule exists! Each building controls its own skyway hours.</p>
                </div>
                
                <div class="quick-actions">
                    <a href="https://skywayaccess.com" class="quick-action" target="_blank">
                        üîç Check Hours
                    </a>
                    <a href="#" class="quick-action" onclick="goToSlide(2)">
                        üè¢ Building Directory
                    </a>
                    <a href="#" class="quick-action" onclick="goToSlide(3)">
                        üó∫Ô∏è Route Planner
                    </a>
                    <a href="#" class="quick-action" onclick="goToSlide(4)">
                        üìä Live Status
                    </a>
                </div>
            </div>
        </div>

        <!-- Slide 2: Building Directory -->
        <div class="slide">
            <div class="card">
                <h1>üè¢ Building Directory</h1>
                
                <div class="search-container">
                    <input type="text" class="search-input" id="buildingSearch" 
                           placeholder="Search buildings..." 
                           oninput="filterBuildings()">
                </div>
                
                <div class="favorites-container">
                    <h3>‚≠ê Your Favorites</h3>
                    <div id="favoriteBuildings" class="building-list">
                        <p style="color: #666; font-style: italic;">No favorites yet. Tap the ‚≠ê on any building to add it!</p>
                    </div>
                </div>
                
                <h3>All Buildings</h3>
                <div id="buildingList" class="building-list">
                    <!-- Buildings will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Slide 3: Route Planner -->
        <div class="slide">
            <div class="card">
                <h1>üó∫Ô∏è Route Planner</h1>
                
                <div class="route-planner">
                    <div class="route-selector">
                        <div class="route-building" id="fromBuilding" onclick="selectFromBuilding()">
                            <div style="font-weight: 600;">From</div>
                            <div id="fromBuildingName">Select Building</div>
                        </div>
                        <div class="route-arrow">‚Üí</div>
                        <div class="route-building" id="toBuilding" onclick="selectToBuilding()">
                            <div style="font-weight: 600;">To</div>
                            <div id="toBuildingName">Select Building</div>
                        </div>
                    </div>
                    
                    <div id="routeResult" class="route-result" style="display: none;">
                        <!-- Route results will be populated here -->
                    </div>
                </div>
                
                <h3>Popular Routes</h3>
                <div id="popularRoutes">
                    <!-- Popular routes will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Slide 4: Live Status -->
        <div class="slide">
            <div class="card">
                <h1>üìä Live Status Dashboard</h1>
                
                <div class="status-summary">
                    <div class="status-card good">
                        <div style="font-size: 1.5em; font-weight: bold;" id="openCount">-</div>
                        <div style="font-size: 0.85em;">Likely Open</div>
                    </div>
                    <div class="status-card warning">
                        <div style="font-size: 1.5em; font-weight: bold;" id="unknownCount">-</div>
                        <div style="font-size: 0.85em;">Unknown</div>
                    </div>
                    <div class="status-card poor">
                        <div style="font-size: 1.5em; font-weight: bold;" id="closedCount">-</div>
                        <div style="font-size: 0.85em;">Likely Closed</div>
                    </div>
                </div>
                
                <div class="highlight">
                    <p><strong>üïê Current Time Analysis</strong></p>
                    <p id="timeAnalysis">Analyzing current conditions...</p>
                </div>
                
                <h3>Weekend-Friendly Buildings</h3>
                <div id="weekendBuildings" class="building-list">
                    <!-- Weekend-friendly buildings will be populated here -->
                </div>
            </div>
        </div>

        <!-- Slide 5: Quick Reference -->
        <div class="slide">
            <div class="card">
                <h1>‚è∞ Quick Reference</h1>
                
                <h3>Weekdays (Mon-Fri)</h3>
                <div class="success">
                    <p><strong>‚úÖ Most segments OPEN</strong></p>
                    <p>Usually 6:00 AM - 6:00 PM</p>
                </div>
                
                <h3>Weekends (Sat-Sun)</h3>
                <div class="warning">
                    <p><strong>‚ùå Most segments CLOSED</strong></p>
                    <p>Limited exceptions - always verify!</p>
                </div>
                
                <h3>Holidays</h3>
                <div class="warning">
                    <p><strong>‚ùå Most segments CLOSED</strong></p>
                    <p>Similar to weekends</p>
                </div>
                
                <div class="highlight">
                    <p><strong>üí° Pro Tip</strong></p>
                    <p>Check SkywayAccess.com before traveling, especially on weekends or after 6 PM!</p>
                </div>
            </div>
        </div>

        <!-- Slide 6: How to Check Hours -->
        <div class="slide">
            <div class="card">
                <h1>üîç How to Check Hours</h1>
                
                <h3>1. SkywayAccess.com</h3>
                <div class="success">
                    <p><strong>‚úÖ Official Resource</strong></p>
                    <p>Search by building name for current hours</p>
                </div>
                
                <h3>2. On-Site Signs</h3>
                <p>Watch for signs showing modified hours</p>
                
                <h3>3. Ask Building Staff</h3>
                <p>Information desks and security can help</p>
                
                <h3>4. Local Knowledge</h3>
                <p>Ask confident-looking pedestrians</p>
                
                <div class="warning">
                    <p><strong>‚ö†Ô∏è Important</strong></p>
                    <p>Building doors may be locked even if skyway is technically open. Check access from street level first!</p>
                </div>
            </div>
        </div>

        <!-- Slide 7: Examples -->
        <div class="slide">
            <div class="card">
                <h1>üìã Building Examples</h1>
                
                <table>
                    <thead>
                        <tr>
                            <th>Building</th>
                            <th>Weekday</th>
                            <th>Weekend</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100 Washington Square</td>
                            <td>6AM-6PM</td>
                            <td>8AM-6PM ‚úÖ</td>
                        </tr>
                        <tr>
                            <td>111 Washington Square</td>
                            <td>6AM-6PM</td>
                            <td>Closed ‚ùå</td>
                        </tr>
                        <tr>
                            <td>Radisson Blu</td>
                            <td>6:30AM-10PM</td>
                            <td>Shorter hrs</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="highlight">
                    <p><strong>üéØ Key Insight</strong></p>
                    <p>These are just examples! Every building is different. Always verify your specific route.</p>
                </div>
            </div>
        </div>

        <!-- Slide 8: Target Center Route -->
        <div class="slide">
            <div class="card">
                <h1>üèÄ Target Center Special Route</h1>
                
                <div class="success">
                    <p><strong>‚úÖ Extended Hours for Events</strong></p>
                    <p>Special route stays open for Timberwolves & Lynx games</p>
                </div>
                
                <h3>Connected Buildings Include:</h3>
                <div class="building-grid">
                    <div class="building-item">Target Center (Arena)</div>
                    <div class="building-item">Multiple Parking Ramps</div>
                    <div class="building-item">Hampton Inn & Suites</div>
                    <div class="building-item">Marriott City Center</div>
                    <div class="building-item">Embassy Suites</div>
                    <div class="building-item">Loews Hotel</div>
                </div>
                
                <div class="highlight">
                    <p><strong>üìç More Info</strong></p>
                    <p>Visit skywayaccess.com/targetcenter/ for route maps and event schedules</p>
                </div>
            </div>
        </div>

        <!-- Slide 9: Major Buildings -->
        <div class="slide">
            <div class="card">
                <h1>üè¢ Major Connected Buildings</h1>
                
                <h3>Popular Entry Points</h3>
                <div class="building-grid">
                    <div class="building-item"><strong>IDS Center</strong> - Crystal Court hub</div>
                    <div class="building-item"><strong>City Center</strong> - Popular entry</div>
                    <div class="building-item"><strong>US Bank Plaza</strong> - Popular entry</div>
                    <div class="building-item"><strong>Target Store</strong> - Nicollet Mall</div>
                    <div class="building-item"><strong>Wells Fargo Center</strong> - Popular entry</div>
                </div>
                
                <h3>Major Venues</h3>
                <div class="building-grid">
                    <div class="building-item">Target Center (NBA/WNBA)</div>
                    <div class="building-item">Target Field (MLB)</div>
                    <div class="building-item">U.S. Bank Stadium (NFL)</div>
                    <div class="building-item">Convention Center</div>
                    <div class="building-item">Central Library</div>
                </div>
                
                <div class="warning">
                    <p><strong>‚ö†Ô∏è Remember</strong></p>
                    <p>Being on this list doesn't guarantee hours! Always verify access times.</p>
                </div>
            </div>
        </div>

        <!-- Slide 10: Navigation Tips -->
        <div class="slide">
            <div class="card">
                <h1>üß≠ Navigation Tips</h1>
                
                <h3>Before You Go</h3>
                <ul>
                    <li>Check SkywayAccess.com for your route</li>
                    <li>Plan a backup street-level route</li>
                    <li>Know that free bathrooms are rare</li>
                </ul>
                
                <h3>Getting Access</h3>
                <ul>
                    <li>Enter buildings and go to 2nd level</li>
                    <li>Look for 'SK' button in elevators</li>
                    <li>Building must be open for access</li>
                </ul>
                
                <h3>If Segments Are Closed</h3>
                <ul>
                    <li>Stay flexible and ready to reroute</li>
                    <li>Go to street level to bypass</li>
                    <li>Re-enter at different building</li>
                    <li>Check signs for detour info</li>
                </ul>
                
                <div class="highlight">
                    <p><strong>üå°Ô∏è Weather Note</strong></p>
                    <p>You may still need outdoor clothing to reach skyway entrances!</p>
                </div>
            </div>
        </div>

        <!-- Slide 11: Key Strategies -->
        <div class="slide">
            <div class="card">
                <h1>üéØ Success Strategies</h1>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-number">1</span>
                        <span class="stat-label">Check SkywayAccess.com</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">2</span>
                        <span class="stat-label">Watch for Signs</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">3</span>
                        <span class="stat-label">Plan Backups</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">4</span>
                        <span class="stat-label">Stay Flexible</span>
                    </div>
                </div>
                
                <h3>The Proactive Approach</h3>
                <div class="success">
                    <ul>
                        <li><strong>Before travel:</strong> Check resources close to departure</li>
                        <li><strong>During travel:</strong> Watch signage, adapt as needed</li>
                        <li><strong>Critical journeys:</strong> Always have street alternatives</li>
                        <li><strong>Weekends/holidays:</strong> Expect restrictions</li>
                    </ul>
                </div>
                
                <div class="highlight">
                    <p><strong>üí° Remember</strong></p>
                    <p>The skyway's engineering provides the pathways; your informed approach unlocks their full utility!</p>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">‚Üê Back</button>
            <div class="slide-counter">
                <span id="current-slide">1</span> / <span id="total-slides">11</span>
            </div>
            <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">Next ‚Üí</button>
        </div>
    </div>

    <!-- Include the new JavaScript modules -->
    <script src="js/buildingData.js"></script>
    <script src="js/routePlanner.js"></script>
    
    <script>
        // Initialize enhanced features
        let routePlanner;
        let favorites = JSON.parse(localStorage.getItem('skyway-favorites') || '[]');
        let selectedFromBuilding = null;
        let selectedToBuilding = null;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            routePlanner = new RoutePlanner(buildingData, routeData);
            initializeBuildingDirectory();
            initializeStatusDashboard();
            initializePopularRoutes();
            updateWeatherStatus();
        });
        
        // Building Directory Functions
        function initializeBuildingDirectory() {
            const buildingList = document.getElementById('buildingList');
            buildingList.innerHTML = '';
            
            buildingData.forEach(building => {
                const buildingCard = createBuildingCard(building);
                buildingList.appendChild(buildingCard);
            });
            
            updateFavoritesList();
        }
        
        function createBuildingCard(building) {
            const card = document.createElement('div');
            card.className = 'building-card';
            card.dataset.buildingId = building.id;
            
            const status = getCurrentStatus(building);
            const statusColor = getStatusColor(status);
            const statusIcon = getStatusIcon(status);
            
            const isFavorite = favorites.includes(building.id);
            
            card.innerHTML = `
                <button class="favorite-btn ${isFavorite ? 'active' : ''}" 
                        onclick="toggleFavorite('${building.id}', event)">
                    ${isFavorite ? '‚≠ê' : '‚òÜ'}
                </button>
                <div class="building-name">${building.name}</div>
                <div class="building-address">${building.address}</div>
                <div class="building-status">
                    <span class="status-indicator" style="background-color: ${statusColor}"></span>
                    ${statusIcon} ${status.replace('-', ' ').toUpperCase()}
                </div>
                <div style="font-size: 0.85em; color: #666; margin-top: 8px;">
                    ${building.description}
                </div>
                <div style="font-size: 0.8em; color: #888; margin-top: 4px;">
                    Weekday: ${building.weekdayHours} | Weekend: ${building.weekendHours}
                </div>
            `;
            
            return card;
        }
        
        function filterBuildings() {
            const query = document.getElementById('buildingSearch').value;
            const results = routePlanner.searchBuildings(query);
            
            const buildingList = document.getElementById('buildingList');
            buildingList.innerHTML = '';
            
            results.forEach(building => {
                const buildingCard = createBuildingCard(building);
                buildingList.appendChild(buildingCard);
            });
        }
        
        function toggleFavorite(buildingId, event) {
            event.stopPropagation();
            
            const index = favorites.indexOf(buildingId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(buildingId);
            }
            
            localStorage.setItem('skyway-favorites', JSON.stringify(favorites));
            initializeBuildingDirectory();
        }
        
        function updateFavoritesList() {
            const favoriteContainer = document.getElementById('favoriteBuildings');
            
            if (favorites.length === 0) {
                favoriteContainer.innerHTML = '<p style="color: #666; font-style: italic;">No favorites yet. Tap the ‚≠ê on any building to add it!</p>';
                return;
            }
            
            favoriteContainer.innerHTML = '';
            favorites.forEach(buildingId => {
                const building = buildingData.find(b => b.id === buildingId);
                if (building) {
                    const card = createBuildingCard(building);
                    favoriteContainer.appendChild(card);
                }
            });
        }
        
        // Route Planner Functions
        function selectFromBuilding() {
            // For now, use a simple prompt - could be enhanced with a modal
            const buildingName = prompt('Enter building name:');
            if (buildingName) {
                const results = routePlanner.searchBuildings(buildingName);
                if (results.length > 0) {
                    selectedFromBuilding = results[0];
                    document.getElementById('fromBuildingName').textContent = selectedFromBuilding.name;
                    document.getElementById('fromBuilding').classList.add('selected');
                    checkForRoute();
                }
            }
        }
        
        function selectToBuilding() {
            const buildingName = prompt('Enter building name:');
            if (buildingName) {
                const results = routePlanner.searchBuildings(buildingName);
                if (results.length > 0) {
                    selectedToBuilding = results[0];
                    document.getElementById('toBuildingName').textContent = selectedToBuilding.name;
                    document.getElementById('toBuilding').classList.add('selected');
                    checkForRoute();
                }
            }
        }
        
        function checkForRoute() {
            if (selectedFromBuilding && selectedToBuilding) {
                const route = routePlanner.findRoute(selectedFromBuilding.id, selectedToBuilding.id);
                displayRoute(route);
            }
        }
        
        function displayRoute(route) {
            const routeResult = document.getElementById('routeResult');
            
            if (!route) {
                routeResult.innerHTML = '<p>No direct route found. Try checking individual building connections.</p>';
                routeResult.style.display = 'block';
                return;
            }
            
            const pathHtml = route.segments.map((segmentId, index) => {
                const building = buildingData.find(b => b.id === segmentId);
                const isLast = index === route.segments.length - 1;
                return `
                    <span class="route-segment">${building ? building.name : segmentId}</span>
                    ${!isLast ? '<span class="route-arrow-small">‚Üí</span>' : ''}
                `;
            }).join('');
            
            let warningsHtml = '';
            if (route.warnings && route.warnings.length > 0) {
                warningsHtml = `
                    <div class="route-warnings">
                        <strong>‚ö†Ô∏è Warnings:</strong>
                        <ul>
                            ${route.warnings.map(warning => `<li>${warning}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            routeResult.innerHTML = `
                <h4>${route.name}</h4>
                <div class="route-path">${pathHtml}</div>
                <p><strong>Estimated Time:</strong> ${route.estimatedTime}</p>
                <p><strong>Weekend Viability:</strong> ${route.weekendViability}</p>
                <p><strong>Notes:</strong> ${route.notes}</p>
                ${warningsHtml}
            `;
            
            routeResult.style.display = 'block';
        }
        
        function initializePopularRoutes() {
            const popularRoutes = routePlanner.getPopularRoutes();
            const container = document.getElementById('popularRoutes');
            
            container.innerHTML = popularRoutes.map(route => `
                <div class="building-item" onclick="loadPopularRoute('${route.id}')">
                    <strong>${route.name}</strong><br>
                    <small>${route.estimatedTime} ‚Ä¢ ${route.weekendViability} weekend access</small>
                </div>
            `).join('');
        }
        
        function loadPopularRoute(routeId) {
            const route = routeData.find(r => r.id === routeId);
            if (route) {
                selectedFromBuilding = buildingData.find(b => b.id === route.from);
                selectedToBuilding = buildingData.find(b => b.id === route.to);
                
                document.getElementById('fromBuildingName').textContent = selectedFromBuilding.name;
                document.getElementById('toBuildingName').textContent = selectedToBuilding.name;
                document.getElementById('fromBuilding').classList.add('selected');
                document.getElementById('toBuilding').classList.add('selected');
                
                displayRoute(routePlanner.enhanceRoute(route));
            }
        }
        
        // Status Dashboard Functions
        function initializeStatusDashboard() {
            updateStatusCounts();
            updateTimeAnalysis();
            updateWeekendBuildings();
        }
        
        function updateStatusCounts() {
            let openCount = 0;
            let closedCount = 0;
            let unknownCount = 0;
            
            buildingData.forEach(building => {
                const status = getCurrentStatus(building);
                switch (status) {
                    case 'likely-open': openCount++; break;
                    case 'likely-closed': closedCount++; break;
                    default: unknownCount++; break;
                }
            });
            
            document.getElementById('openCount').textContent = openCount;
            document.getElementById('closedCount').textContent = closedCount;
            document.getElementById('unknownCount').textContent = unknownCount;
        }
        
        function updateTimeAnalysis() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();
            const isWeekend = day === 0 || day === 6;
            
            let analysis = '';
            
            if (isWeekend) {
                analysis = 'It\'s the weekend! Most office buildings are closed, but hotels, some retail locations, and event venues may be open.';
            } else if (hour >= 6 && hour <= 18) {
                analysis = 'Peak skyway hours! Most buildings should be accessible.';
            } else if (hour >= 19 && hour <= 22) {
                analysis = 'Evening hours - many office buildings are closing. Hotels and some retail remain open.';
            } else {
                analysis = 'Late night/early morning - most buildings are closed except 24-hour locations like hotels.';
            }
            
            document.getElementById('timeAnalysis').textContent = analysis;
        }
        
        function updateWeekendBuildings() {
            const weekendBuildings = routePlanner.getWeekendFriendlyBuildings();
            const container = document.getElementById('weekendBuildings');
            
            container.innerHTML = weekendBuildings.map(building => {
                const status = getCurrentStatus(building);
                const statusIcon = getStatusIcon(status);
                return `
                    <div class="building-item">
                        <strong>${building.name}</strong> ${statusIcon}<br>
                        <small>${building.weekendHours}</small>
                    </div>
                `;
            }).join('');
        }
        
        function updateWeatherStatus() {
            // Simple weather-based recommendation
            const now = new Date();
            const month = now.getMonth();
            const isWinter = month >= 11 || month <= 2;
            const isSummer = month >= 5 && month <= 8;
            
            const weatherStatus = document.getElementById('weatherStatus');
            
            if (isWinter) {
                weatherStatus.innerHTML = `
                    <p><strong>‚ùÑÔ∏è Winter Weather Alert!</strong></p>
                    <p>Perfect weather for skyway travel - stay warm and dry!</p>
                `;
            } else if (isSummer) {
                weatherStatus.innerHTML = `
                    <p><strong>‚òÄÔ∏è Summer Comfort!</strong></p>
                    <p>Beat the heat with air-conditioned skyway travel</p>
                `;
            } else {
                weatherStatus.innerHTML = `
                    <p><strong>üå§Ô∏è Great Day for Skyways!</strong></p>
                    <p>Comfortable indoor travel awaits</p>
                `;
            }
        }
        
        // Original slide navigation code
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        
        document.getElementById('total-slides').textContent = totalSlides;

        function showSlide(n) {
            slides[currentSlide].classList.remove('active');
            currentSlide = (n + totalSlides) % totalSlides;
            slides[currentSlide].classList.add('active');
            
            document.getElementById('current-slide').textContent = currentSlide + 1;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides - 1;
        }

        function changeSlide(direction) {
            if (direction === 1 && currentSlide < totalSlides - 1) {
                showSlide(currentSlide + 1);
            } else if (direction === -1 && currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }

        function goToSlide(n) {
            showSlide(n);
        }

        // Touch/swipe support
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (touchEndX < touchStartX - 50) {
                changeSlide(1); // Swipe left - next slide
            }
            if (touchEndX > touchStartX + 50) {
                changeSlide(-1); // Swipe right - previous slide
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                changeSlide(1);
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                changeSlide(-1);
            }
        });

        // PWA Install functionality
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                installPrompt.style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            installPrompt.style.display = 'none';
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(
                    'data:application/javascript;base64,' + btoa(`
                        const CACHE_NAME = 'skyway-navigator-v1';
                        const urlsToCache = ['./', '/'];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME).then((cache) => {
                                    return cache.addAll(urlsToCache);
                                })
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request).then((response) => {
                                    return response || fetch(event.request);
                                })
                            );
                        });
                    `)
                ).catch((error) => {
                    console.log('SW registration failed');
                });
            });
        }

        // Initialize
        showSlide(0);
    </script>

    <!-- Web App Manifest -->
    <script>
        
        // Live Data Integration with Perplexity API
        class LiveDataService {
            constructor() {
                this.apiKey = localStorage.getItem('perplexity_api_key') || '';
                this.baseUrl = 'https://api.perplexity.ai/chat/completions';
            }
            
            setApiKey(key) {
                this.apiKey = key;
                localStorage.setItem('perplexity_api_key', key);
            }
            
            async fetchBuildingHours(buildingName) {
                if (!this.apiKey) {
                    console.warn('Perplexity API key not set');
                    return null;
                }
                
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'llama-3.1-sonar-small-128k-online',
                            messages: [{
                                role: 'user',
                                content: `What are the current skyway access hours for ${buildingName} in Minneapolis? Please provide weekday and weekend hours if available.`
                            }],
                            max_tokens: 200,
                            temperature: 0.1
                        })
                    });
                    
                    const data = await response.json();
                    return data.choices[0]?.message?.content || null;
                } catch (error) {
                    console.error('Error fetching live data:', error);
                    return null;
                }
            }
            
            async updateBuildingData() {
                if (!this.apiKey) return;
                
                const updatedBuildings = [];
                for (const building of buildingData) {
                    const liveHours = await this.fetchBuildingHours(building.name);
                    if (liveHours) {
                        updatedBuildings.push({
                            ...building,
                            liveHours: liveHours,
                            lastUpdated: new Date().toISOString()
                        });
                    } else {
                        updatedBuildings.push(building);
                    }
                    // Add delay to respect API rate limits
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                return updatedBuildings;
            }
        }
        
        // Initialize live data service
        const liveDataService = new LiveDataService();
        
        // Add API key setup function
        function setupPerplexityAPI() {
            const apiKey = prompt('Enter your Perplexity API key to enable live data updates:');
            if (apiKey) {
                liveDataService.setApiKey(apiKey);
                alert('API key saved! Live data updates are now enabled.');
            }
        }
        
        // Add live data update function
        async function updateLiveData() {
            if (!liveDataService.apiKey) {
                setupPerplexityAPI();
                return;
            }
            
            const updateBtn = document.getElementById('updateDataBtn');
            if (updateBtn) {
                updateBtn.textContent = 'Updating...';
                updateBtn.disabled = true;
            }
            
            try {
                const updatedData = await liveDataService.updateBuildingData();
                // Refresh the building directory with updated data
                if (typeof refreshBuildingDirectory === 'function') {
                    refreshBuildingDirectory(updatedData);
                }
                alert('Building data updated with live information!');
            } catch (error) {
                console.error('Error updating live data:', error);
                alert('Error updating live data. Please check your API key and try again.');
            } finally {
                if (updateBtn) {
                    updateBtn.textContent = 'Update Live Data';
                    updateBtn.disabled = false;
                }
            }
        }
    </script>
</body>
</html>